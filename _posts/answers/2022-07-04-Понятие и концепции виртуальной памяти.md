---
layout: post
title: "Понятие и концепции виртуальной памяти"
categories: sppo-questions pors-questions
---

Виртуальная память (англ. virtual memory) — метод управления памятью компьютера, позволяющий выполнять программы,
требующие больше оперативной памяти, чем имеется в компьютере, путём автоматического перемещения частей программы между
основной памятью и вторичным хранилищем (например, жёстким диском). Для выполняющейся программы данный метод
полностью прозрачен и не требует дополнительных усилий со стороны программиста, однако реализация этого метода требует
как аппаратной поддержки, так и поддержки со стороны операционной системы.

В системе с виртуальной памятью используемые программами адреса, называемые виртуальными адресами, транслируются в
физические адреса в памяти компьютера. Трансляцию виртуальных адресов в физические выполняет аппаратное обеспечение,
называемое блоком управления памятью. Для программы основная память выглядит как доступное и непрерывное адресное
пространство либо как набор непрерывных сегментов, вне зависимости от наличия у компьютера соответствующего объёма
оперативной памяти. Управление виртуальными адресными пространствами, соотнесение физической и виртуальной памяти, а
также перемещение фрагментов памяти между основным и вторичным хранилищами выполняет операционная система (см. подкачка
страниц).

Применение виртуальной памяти позволяет:

- освободить программиста от необходимости вручную управлять загрузкой частей программы в память и согласовывать
  использование памяти с другими программами
- предоставлять программам больше памяти, чем физически установлено в системе
- в многозадачных системах изолировать выполняющиеся программы друг от друга путём назначения им непересекающихся
  адресных пространств (см. защита памяти)

Общепринятая в настоящее время концепция виртуальной памяти появилась достаточно давно. Она позволила решить целый ряд
актуальных вопросов организации вычислений. Прежде всего к числу таких вопросов относится обеспечение надежного
функционирования мультипрограммных систем.

В любой момент времени компьютер выполняет множество процессов или задач, каждая из которых располагает своим адресным
пространством. Было бы слишком накладно отдавать всю физическую память какой-то одной задаче тем более, что многие
задачи реально используют только небольшую часть своего адресного пространства. Поэтому необходим механизм разделения
небольшой физической памяти между различными задачами. Виртуальная память является одним из способов реализации такой
возможности. Она делит физическую память на блоки и распределяет их между различными задачами. При этом она
предусматривает также некоторую схему защиты, которая ограничивает задачу теми блоками, которые ей принадлежат.
Большинство типов виртуальной памяти сокращают также время начального запуска программы на процессоре, поскольку не весь
программный код и данные требуются ей в физической памяти, чтобы начать выполнение.

Другой вопрос, тесно связанный с реализацией концепции виртуальной памяти, касается организации вычислений на компьютере
задач очень большого объема. Если программа становилась слишком большой для физической памяти, часть ее необходимо было
хранить во внешней памяти (на диске) и задача приспособить ее для решения на компьютере ложилась на программиста.
Программисты делили программы на части и затем определяли те из них, которые можно было бы выполнять независимо,
организуя оверлейные структуры, которые загружались в основную память и выгружались из нее под управлением программы
пользователя. Программист должен был следить за тем, чтобы программа не обращалась вне отведенного ей пространства
физической памяти. Виртуальная память освободила программистов от этого бремени. Она автоматически управляет двумя
уровнями иерархии памяти: основной памятью и внешней (дисковой) памятью.

Кроме того, виртуальная память упрощает также загрузку программ, обеспечивая механизм автоматического перемещения
программ, позволяющий выполнять одну и ту же программу в произвольном месте физической памяти.

Системы виртуальной памяти можно разделить на два класса: системы с фиксированным размером блоков, называемых
страницами, и системы с переменным размером блоков, называемых сегментами.

### Страничная организация памяти

В системах со страничной организацией основная и внешняя память (главным образом дисковое пространство) делятся на блоки
или страницы фиксированной длины. Каждому пользователю предоставляется некоторая часть адресного пространства, которая
может превышать основную память компьютера и которая ограничена только возможностями адресации, заложенными в системе
команд. Эта часть адресного пространства называется виртуальной памятью пользователя. Каждое слово в виртуальной памяти
пользователя определяется виртуальным адресом, состоящим из двух частей: старшие разряды адреса рассматриваются как
номер страницы, а младшие - как номер слова (или байта) внутри страницы.

### Сегментация памяти

Другой подход к организации памяти опирается на тот факт, что программы обычно разделяются на отдельные
области-сегменты. Каждый сегмент представляет собой отдельную логическую единицу информации, содержащую совокупность
данных или программ и расположенную в адресном пространстве пользователя. Сегменты создаются пользователями, которые
могут обращаться к ним по символическому имени. В каждом сегменте устанавливается своя собственная нумерация слов,
начиная с нуля.

Обычно в подобных системах обмен информацией между пользователями строится на базе сегментов. Поэтому сегменты являются
отдельными логическими единицами информации, которые необходимо защищать, и именно на этом уровне вводятся различные
режимы доступа к сегментам. Можно выделить два основных типа сегментов: программные сегменты и сегменты данных (сегменты
стека являются частным случаем сегментов данных). Поскольку общие программы должны обладать свойством повторной
входимости, то из программных сегментов допускается только выборка команд и чтение констант. Запись в программные
сегменты может рассматриваться как незаконная и запрещаться системой. Выборка команд из сегментов данных также может
считаться незаконной и любой сегмент данных может быть защищен от обращений по записи или по чтению.

Для реализации сегментации было предложено несколько схем, которые отличаются деталями реализации, но основаны на одних
и тех же принципах.

В системах с сегментацией памяти каждое слово в адресном пространстве пользователя определяется виртуальным адресом,
состоящим из двух частей: старшие разряды адреса рассматриваются как номер сегмента, а младшие - как номер слова внутри
сегмента. Наряду с сегментацией может также использоваться страничная организация памяти. В этом случае виртуальный
адрес слова состоит из трех частей: старшие разряды адреса определяют номер сегмента, средние - номер страницы внутри
сегмента, а младшие - номер слова внутри страницы.

Как и в случае страничной организации, необходимо обеспечить преобразование виртуального адреса в реальный физический
адрес основной памяти. С этой целью для каждого пользователя операционная система должна сформировать таблицу сегментов.
Каждый элемент таблицы сегментов содержит описатель (дескриптор) сегмента (поля базы, границы и индикаторов режима
доступа). При отсутствии страничной организации поле базы определяет адрес начала сегмента в основной памяти, а граница -
длину сегмента. При наличии страничной организации поле базы определяет адрес начала таблицы страниц данного сегмента,
а граница - число страниц в сегменте. Поле индикаторов режима доступа представляет собой некоторую комбинацию признаков
блокировки чтения, записи и выполнения.
