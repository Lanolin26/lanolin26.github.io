---
layout: post
title: "Программные и аппаратные прерывания и их отличия"
categories: sppo-questions pors-questions
---

Почти во всех компьютерах предусмотрен механизм, с помощью которого различные модули (ввода-вывода, памяти) могут
прервать нормальную последовательность работы процессора. Основные общепринятые классы прерываний перечислены в табл.
1.1.

ТАБЛИЦА 1.1. КЛАССЫ ПРЕРЫВАНИЙ

|                 |                                                                                                                                                                                                                                                                            |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Программные     | Генерируются в некоторых ситуациях, возникающих в результате выполнения команд. Такими ситуациями могут быть арифметическое переполнение, деление на нуль, попытка выполнить некорректную команду или обратиться к области памяти, доступ к которой  пользователю запрещен |
| Таймера         | Генерируется таймером процессора. Это прерывание позволяет операционной системе выполнять некоторые функции периодически, через заданные промежутки времени                                                                                                                |
| Ввода-вывода    | Генерируется контроллером ввода-вывода. Сигнализирует о нормальном завершении операции или о наличии ошибок                                                                                                                                                                |
| Аппаратный сбой | Генерируется при сбоях и аварийных ситуациях, как, например, падение напряжения в сети или ошибка контроля четности памяти                                                                                                                                                 |

Прерывания предназначены в основном дпя повышения эффективности использования процессора. Например, большинство
устройств ввода-вывода работают намного медленнее, чем процессор. Предположим, что процессор передает данные на принтер
по схеме, показанной на рис. 1.2. После каждой операции процессор вынужден делать паузу и ждать, пока принтер примет
данные. Длительность этой паузы может быть в тысячи или даже миллионы раз больше длительности цикла команды. Ясно, что
подобное использование процессора является крайне неэффективным.

Чтобы привести конкретный пример, рассмотрим персональный компьютер, который работает с частотой 1 ГГц, что позволяет
выполнять примерно 109 команд в секунду. А типичный жесткий диск имеет скорость вращения 7200 об/мин, что дает время
обращения половины дорожки около 4 мс - в 4 миллиона раз медленнее, чем работа процессора.

Это положение дел проиллюстрировано на рис. 1.5, а. Программа пользователя содержит ряд вызовов процедуры записи WRITE,
в промежутках между которыми расположены другие команды. Сплошные вертикальные линии представляют отрезки кода
программы. В отрезках 1, 2 и 3 находятся последовательности команд кода, в которых не используется ввод-вывод. При
вызове процедуры WRITE управление передается системной подпрограмме ввода-вывода, которая выполняет соответствующие
операции.

![Ход выполнения программы без прерываний и с их использованием](/assets/q48-1.png)

Рис. 1.5. Ход выполнения программы без прерываний и с их использованием

Программа ввода-вывода состоит из трех частей.

- Последовательность команд, обозначенных на рисунке цифрой 4, которые служат для подготовки к собственно операциям
  ввода-вывода. В эту последовательность могут входить копирование выводимых данных в специальный буфер и подготовка
  набора параметров, необходимых для управления устройством.
- Собственно команда ввода-вывода. Если программа не использует прерываний, ей придется ждать, пока устройство
  ввода-вывода не выполнит требуемые операции (или периодически проверять его состояние путем опроса). При этом
  программе не остается ничего другого, как просто ждать, постоянно проверяя, завершилась ли операция ввода-вывода.
- Последовательность команд, обозначенных на рисунке цифрой 5, которые служат для завершения операции. Эта
  последовательность может содержать в себе установку флагов, свидетельствующих об успешном или неудачном завершении
  операции.

Пунктирная линия представляет путь выполнения, которому следует процессор, т.е. эта строка показывает
последовательность, в которой выполняются команды. Таким образом, после первой встреченной команды WRITE выполнение
пользовательской программы прерывается, и процессор приступает к выполнению программы ввода-вывода. После завершения
выполнения программы ввода-вывода возобновляется выполнение программы пользователя с команды, непосредственно следующей
за командой WRITE.

Из-за того что для выполнения операции ввода-вывода может потребоваться сравнительно длительный промежуток времени,
программа замедляет работу, ожидая завершения операции. Таким образом, там, где встречается вызов WRITE,
производительность программы существенно уменьшается.

### Классификация прерываний

В зависимости от источника, прерывания делятся на

- **аппаратные** - возникают как реакция микропроцессора на физический сигнал от некоторого устройства (клавиатура,
  системные часы, клавиатура, жесткий диск и т.д.), по времени возникновения эти прерывания асинхронны, т.е. происходят
  в случайные моменты времени;
- **программные** - вызываются искусственно с помощью соответствующей команды из программы (int), предназначены для
  выполнения некоторых действий операционной системы, являются синхронными;
- **исключения** - являются реакцией микропроцессора на нестандартную ситуацию, возникшую внутри микропроцессора во
  время
  выполнения некоторой команды программы (деление на ноль, прерывание по флагу TF (трассировка)).


 