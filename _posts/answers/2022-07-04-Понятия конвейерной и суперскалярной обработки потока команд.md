---
layout: post
title: "Понятия конвейерной и суперскалярной обработки потока команд"
categories: sppo-questions pors-questions
---

## Конвейер

**Конвейерный принцип** обработки информации. Принцип подразумевает, что в каждый момент времени процессор работает над
различными стадиями выполнения нескольких команд, причем на выполнение каждой стадии выделяются отдельные аппаратные
ресурсы. По очередному тактовому импульсу каждая команда в конвейере продвигается на следующую стадию обработки,
выполненная команда покидает конвейер, а новая поступает в него.

Конвейеризация (или конвейерная обработка) в общем случае основана на разделении подлежащей исполнению функции на более
мелкие части, называемые ступенями, и выделении для каждой из них отдельного блока аппаратуры. Производительность при
этом возрастает благодаря тому, что одновременно на различных ступенях конвейера выполняются несколько команд.
Конвейерная обработка такого рода широко применяется во всех современных быстродействующих процессорах. Выполнение
типичной команды можно разделить на следующие этапы:

- С1 – выборка команды (по адресу, заданному счетчиком команд, из памяти извлекается команда и помещается в буфер);
- С2 – декодирование команды (определение КОП и типа операндов);
- С3 – выборка операндов (определение местонахождения операндов и вызов их из регистров);
- С4 – выполнение команды;
- С5 – запись результата в нужный регистр.

Параллелизм нижнего уровня реализуется на однопроцессорных машинах. Название однопроцессорные предполагает, что подобные
архитектуры выполняют только один поток команд. Классическим примером однопроцессорной архитектуры является архитектура
фон Неймана со строго последовательным выполнением команд.

При конвейерной обработке часто возникают конфликты, которые препятствуют выполнению очередной команды в предназначенном
для нее такте. Конфликты могут иметь различное происхождение, но в целом их можно охарактеризовать как структурные, по
управлению и по данным.

**Структурные конфликты** возникают в том случае, когда аппаратные средства процессора не могут поддерживать все возможные
комбинации команд в режиме одновременного выполнения с совмещением.

**Конфликты по данным** возникают в случаях, когда выполнение одной команды зависит от результата выполнения предыдущей
команды. Устранение конфликтов по данным типов WAR и WAW достигается путем отказа от неупорядоченного исполнения команд,
но чаще всего путем введения буфера восстановления последовательности команд.

**Недостаточное дублирование некоторых ресурсов**
Одним из типичных примеров служит конфликт из-за доступа к запоминающим устройствам. Борьба с конфликтами такого рода
проводится путем увеличения количества однотипных функциональных устройств, которые могут одновременно выполнять одни и
те же или схожие функции. Например, в современных микропроцессорах обычно разделяют кэш-память для хранения команд и
кэш-память данных, а также используют много портовую схему доступа к регистровой памяти, при которой к регистрам можно
одновременно обращаться по одному каналу для записи, а по другому - для считывания информации. Конфликты из-за
исполнительных устройств обычно сглаживаются введением в состав микропроцессора дополнительных блоков. Так, в
микропроцессоре Pentium-4 предусмотрено 4 АЛУ для обработки целочисленных данных. Процессоры, имеющие в своем составе
более одного конвейера, называются суперскалярными.

## Суперскалярные архитектуры

Смысл суперскалярной обработки - наличие в аппаратуре средств, позволяющих одновременно выполнять две и более скалярных
операций, т.е. команд обработки пары чисел. В самом деле, суть этого метода довольно проста: имеется в виду дублирование
устройств процессора. Этот метод хорош тем, что он "прозрачен" для программиста - составление программ для подобных
процессоров не требует никаких специальных усилий, ответственность за параллельное выполнение операций возлагается в
основном на аппаратные средства.

Второй способ реализации суперскалярной обработки заключается в кардинальной перестройке всего процесса трансляции и
исполнения программ. Уже на этапе подготовки программы компилятор группирует не связанные операции в пакеты, содержимое
которых строго соответствует структуре процессора. Например, если процессор содержит функционально независимые
устройства сложения, умножения, сдвига и деления, то максимум, что компилятор может "уложить" в один пакет - это четыре
разнотипные операции:  сложение, умножение, сдвиг и деление. Сформированные пакеты операций преобразуются компилятором в
командные слова.  

Функции стадии С1 (выборка команд, а также тезис – один конвейер хорошо, а два лучше) позволяют реализовать структуру с
двойным конвейером.

![Двойной конвейер из пяти стадий](/assets/q45-1.png)

Рис. 12.4 Двойной конвейер из пяти стадий

Можно и дальше наращивать число конвейеров, но это значительно осложнило бы аппаратную часть. Вместо этого было
предложено использовать один конвейер с большим количеством функциональных блоков (Pentium II – суперскалярный
процессор).

![Суперскалярный процессор с пятью функциональными блоками](/assets/q45-2.png)

Рис 12.5 Суперскалярный процессор с пятью функциональными блоками

Недостатком суперскалярных микропроцессоров является необходимость синхронного продвижения команд в каждом из
конвейеров. К тому же, как мы уже отмечали, кроме параллелизма на уровне команд существует параллелизм на уровне данных,
реализация этого вида параллелизма требует применения многопроцессорной архитектуры. 
